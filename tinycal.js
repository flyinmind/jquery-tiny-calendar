(function(f){var e=[31,28,31,30,31,30,31,31,30,31,30,31];var g=["日","一","二","三","四","五","六"];var m=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"];var p=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var o=["January","February","March","April","May","June","July","August","September","October","November","December"];var k=new Date();var h=function(s,t,r){t++;return r?(s+"-"+j(t)+"-"+j(r)):(s+"-"+j(t))};var l=function(s){var r=s.split("-");var t=new Date();t.setYear(parseInt(r[0]));t.setMonth(parseInt(r[1]));if(r[2]){t.setDate(parseInt(r[2]))}else{t.setDate(1)}return t};function j(r){if(r<10){return"0"+r}return r}f.addZero=j;var i=function(u,v){var r=[];for(var t in u){if(t>0){r.push(",")}r.push(u[t].year+"-"+j(u[t].month+1)+"-"+j(u[t].day))}var s=f(v);if(s.attr("type")){s.val(r.join(""))}else{s.html(r.join(""))}return true};var n={lang:"cn",weekDays:g,months:m,target:"",divName:"#_calendar_div",mode:"single",format:h,parse:l,ok:i,recordState:false,num:1,width:250,height:260,blurBefore:null};function b(r){return((r%4==0&&r%100!=0)||(r%400)==0)}function d(w,x,r,v){var u;for(var t=0,s=v.checked.length;t<s;t++){u=v.checked[t];if(u.year==w&&u.month==x&&u.day==r){return t}}return -1}function c(t,u,r,s){var v=d(t,u,r,s);if(v>=0){s.checked.splice(v,1)}}function a(u,r,t,s){return(u-s.getFullYear())*360+(r-s.getMonth())*30+(t-s.getDate())}var q={};f.fn.calendar=function(u){var t={checked:[],records:[]};f.extend(t,n);f.extend(t,u);if(t.lang=="cn"){t.weekDays=g;t.months=m}else{t.weekDays=p;t.months=o}q[t.target]=t;f(t.target).click({target:t.target},function(y){var x=q[y.data.target];if(x){if(x.mode!="multi"){x.checked=[]}if(!x.recordState){x.records=[]}if(x.records.length<x.num){for(var w=x.records.length;w<x.num;w++){x.records.push({year:k.getFullYear(),month:k.getMonth()})}}v(x)}});function r(){var w=Math.max.apply(null,f.map(f("body > *"),function(x,y){if(f(x).css("position")=="absolute"){return parseInt(f(x).css("z-index"))||1}}));return w}function s(x){var y=x.data.target;var w=q[y];if(x.data.force||f(x.target).closest(w.divName).length==0){f(document).unbind("mouseup");f(w.divName).fadeOut()}}function v(z){var I=z.target;var B,K,J;var G=[];G.push('<div style="height:16px;text-align:right;">');if(z.mode=="multi"){G.push('<span class="calendar_opr ok"></span>')}G.push('<span class="calendar_opr close"></span></div>');for(var A=0;A<z.num;A++){B=z.records[A];K=e[B.month];if(z.month==1){if(b(B.year)){K=29}}J=new Date(B.year,B.month,1).getDay();G.push('<div style="float:left;width:',z.width,'px;">');G.push('<div style="margin:5px;">');G.push('<table class="calendar" style="border-collapse: collapse;"><tr>','<td style="text-align:left;"><span class="calendar_btn foreYear" no="',A,'"></span>','&nbsp;<span class="calendar_btn foreMonth" no="',A,'"></span></td>','<td align="center">',z.format(B.year,B.month),'</td><td style="text-align:right;"><span class="calendar_btn nextMonth" no="',A,'"></span>','&nbsp;<span class="calendar_btn nextYear" no="',A,'"></span></td>',"</tr></table>");G.push('<table class="calendar"><tr>');for(var E=0;E<7;E++){G.push("<td>",z.weekDays[E],"</td>")}G.push("</tr>");var M=1;for(var E=0;E<6&&M<=K;E++){G.push("<tr>");for(var D=0;D<7;D++){G.push("<td");if(M<=K&&(E>0||D>=J)){if(a(B.year,B.month,M,k)==0){G.push(' class="today"')}G.push(' align="center" valign="middle">');G.push('<div class="calendar_day ');if(d(B.year,B.month,M,z)>=0){G.push("selectedDay")}else{if(z.blurBefore&&(z.blurBefore instanceof Date)&&a(B.year,B.month,M,z.blurBefore)<0){G.push("blur")}else{G.push("day")}}G.push('" day="',M,'" no="',A,'">',M,"</div>");M++}else{G.push(">")}G.push("</td>")}G.push("</tr>")}G.push("</table>");G.push("</div>");G.push("</div>")}var O=f(z.divName);if(O.size()<=0){var w='<div id="'+z.divName.substr(1)+'" class="calendar_body"';if(z.zIndex){w+=' style="z-index:'+z.zIndex+'"'}w+="/>";f("body").append(w);O=f(z.divName)}O.width(z.num*z.width);O.html(G.join(""));var H=f(I);var C=H.offset();var N=C.left;var L=C.top;var F=H.height();O.css({top:(L+F+6),left:N,"z-index":r(),height:z.height+"px",width:(z.width*z.num)+"px"});O.fadeIn();f(document).mouseup({target:I},s);f("span.calendar_btn.foreYear").click({target:I},function(y){var P=parseInt(f(this).attr("no"));var x=q[y.data.target];if(x.records[P].year>1900){x.records[P].year--;v(x)}});f("span.calendar_btn.foreMonth").click({target:I},function(y){var P=parseInt(f(this).attr("no"));var x=q[y.data.target];if(x.records[P].month>0){x.records[P].month--;v(x)}else{if(x.records[P].year>1900){x.records[P].month=11;x.records[P].year--;v(x)}}});f("span.calendar_btn.nextYear").click({target:I},function(y){var P=parseInt(f(this).attr("no"));var x=q[y.data.target];if(x.records[P].year<2200){x.records[P].year++;v(x)}});f("span.calendar_btn.nextMonth").click({target:I},function(y){var x=q[y.data.target];var P=parseInt(f(this).attr("no"));if(x.records[P].month<11){x.records[P].month++;v(x)}else{if(x.records[P].year<2200){x.records[P].year++;x.records[P].month=0;v(x)}}});f("div.calendar_day.day").click({target:I},function(x){var V=f(this).attr("day");if(!V){return}V=parseInt(V);var R=parseInt(f(this).attr("no"));var U=x.data.target;var y=q[U];var T={year:y.records[R].year,month:y.records[R].month,day:V};if(y.mode=="single"){y.checked[0]=T;if(y.ok([T],U)){f(y.divName).fadeOut()}}else{if(y.mode=="multi"){y.checked.push(T);v(y)}else{y.checked.push(T);if(y.checked.length>2){y.checked.splice(1,1)}if(y.checked.length>1){var P=y.checked[0];var S=new Date(P.year,P.month,P.day);var P=y.checked[1];var Q=new Date(P.year,P.month,P.day);if(S.getTime()>Q.getTime()){y.checked[0]={year:Q.getFullYear(),month:Q.getMonth(),day:Q.getDate()};y.checked[1]={year:S.getFullYear(),month:S.getMonth(),day:S.getDate()}}if(y.ok(y.checked,U)){f(y.divName).fadeOut()}}else{v(y)}}}});f("div.calendar_day.selectedDay").click({target:I},function(P){var x=f(this).attr("day");if(!x){return}var Q=P.data.target;var y=q[Q];var R=parseInt(f(this).attr("no"));c(y.records[R].year,y.records[R].month,x,y);v(y)});f("span.calendar_opr.close").click({target:I,force:true},function(x){s(x)});f("span.calendar_opr.ok").click({target:I,force:true},function(y){var P=y.data.target;var x=q[P];x.ok(x.checked,P);s(y)})}}})(jQuery);